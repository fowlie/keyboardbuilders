<!--
Welcome to the Source Code!
That means you are a developer.

This site is built using HTML, CSS, and JavaScript.
No frameworks, no bundling, just the basics.
And that makes it not only easy to understand, but also very fun!

Having said that, I'm happy to accept pull requests to improve the site.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Keyboard Builders</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator.min.css" rel="stylesheet" />
  <link rel="icon" type="image/png" href="/favicon.png">
  <style>
    /*
    --- Color Palette ---
    Pearl:        #E0D7B8
    Moss green:   #768948
    Hunter green: #34623F
    Dark green:   #1e2F23
    Black:        #181717
    ---------------------
    */

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background-color: #34623F;
      background-image:
        repeating-linear-gradient(0deg, #fff2 0, #fff2 1px, transparent 1px, transparent 40px),
        repeating-linear-gradient(90deg, #fff2 0, #fff2 1px, transparent 1px, transparent 40px);
    }

    /* These two makes the footer stick to the bottom of the screen */
    html, body {
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    main {
      flex: 1;
    }

    header {
      padding: 1rem;
      text-align: left;
      background-color: #1E2F23;
      box-shadow: 0 4px 24px #0004;
    }

    .site-logo {
      height: 48px;
      vertical-align: middle;
      margin-right: 1rem;
    }

    .site-title {
      display: inline;
      vertical-align: middle;
    }

    h1,h2,h3 {
      margin: 0;
      color: #E0D7B8;
      text-shadow:
        0 4px 16px #181717,
        0 2px 0 #768948,
        0 1px 0 #E0D7B8;
    }

    p {
      text-align: center;
      margin: 1rem 0;
      color: #E0D7B8;
    }

    #keyboard-table {
      max-width: 100%;
      margin: 2rem auto;
      padding: 1rem;
      background: #1E2F23;
      border-radius: 8px;
    }

    #featured-keyboard {
      filter: drop-shadow(20px 20px 4px #181717);
    }

    #featured-keyboard img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0003;
    }

    #featured-keyboard-specs {
      list-style: none;
      padding: 0;
      margin: 0 0 1rem 0;
    }

    .github-corner {
      position: absolute;
      top: 0;
      right: 0;
      padding: 8px;
      z-index: 1000;
    }

    .github-corner svg {
      fill: #E0D7B8;
      stroke: #181717;
      stroke-width: 0.5;
      height: 32px;
      width: 32px;
      display: block;
    }

    kbd {
      border: 1px solid #181717;
      border-radius: 4px;
      background: #E0D7B8;
      padding: 2px 6px;
      font-size: 1em;
      font-family: monospace;
      color: #34623F;
    }

    .image-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .image-wrapper img {
      display: block;
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0003;
    }

    .loading-text {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(24, 23, 23, 0.6);
      color: #E0D7B8;
      font-weight: bold;
      font-size: 1.2rem;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .image-wrapper.loading .loading-text {
      opacity: 1;
    }

    #goatcounter-stats {
      font-weight: bold;
      border: 1px solid #181717;
      border-radius: 4px;
      background: #34623F;
      padding: 2px 6px;
      font-size: 1em;
      font-family: monospace;
      color: #E0D7B8;
    }

    footer {
      box-shadow: 0 4px 24px #0004;
      margin-top: 2rem;
      padding: 2rem;
      text-align: center;
      background-color: #1E2F23;
      color: #E0D7B8;
      box-shadow: 0 -4px 24px #0004;
    }

    footer a {
      color: #E0D7B8;
    }
  </style>
</head>
<body>

  <a href="https://github.com/fowlie/keyboardbuilders" class="github-corner" aria-label="View source on GitHub" target="_blank" rel="noopener">
    <svg viewBox="0 0 16 16" aria-hidden="true">
      <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.65 7.65 0 0 1 2-.27c.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
    </svg>
  </a>

  <header>
    <img src="logo.png" alt="Keyboard Builders logo" class="site-logo">
    <h1 class="site-title">Keyboard Builders</h1>
  </header>

  <main>
    <div id="keyboard-table"></div>

    <p>
      ðŸ’¡<strong>Tip:</strong>
      Press <kbd>/</kbd> or <kbd>CTRL+K</kbd> to search.   
      Navigate using <kbd>j</kbd>/<kbd>k</kbd> to select a keyboard.
    </p>

    <section id="featured-keyboard" style="max-width: 500px; margin: 2rem auto; background: #223b2c; color: #E0D7B8; border-radius: 8px; box-shadow: 0 2px 8px #0003; padding: 1.5rem; text-align: center;">
      <h2 id="featured-keyboard-title"></h2>
      <div class="image-wrapper loading">
        <img id="featured-keyboard-img" alt="Featured Keyboard">
        <div class="loading-text">Loadingâ€¦</div>
      </div>
      <ul id="featured-keyboard-specs">
      </ul>
      <a id="featured-keyboard-link" href="https://github.com/kata0510/Lily58" target="_blank" rel="noopener" style="color: #9ef7b3; text-decoration: underline;">Go to repo</a>
    </section>
  </main>

  <footer>
    <div id="goatcounter">
        Created by <a href="https://fowlie.github.io" target="_blank">fowlie</a> -
        <a href="https://www.goatcounter.com" target="_blank">Goat counter</a> <span id="goatcounter-stats"></span>
    </div>
  </footer>

  <script src="https://unpkg.com/tabulator-tables@6.3.1/dist/js/tabulator.min.js"></script>

  <script>
    function updateFeaturedKeyboard(keyboard) {
      const wrapper = document.querySelector(".image-wrapper");
      const img = document.getElementById("featured-keyboard-img");

      wrapper.classList.add("loading");
      img.onload = () => wrapper.classList.remove("loading");
      img.src = keyboard.image;

      document.getElementById("featured-keyboard-title").textContent = keyboard.name;
      document.getElementById("featured-keyboard-specs").innerHTML = `
        <li><strong>Keys:</strong> ${keyboard.keys || ""}</li>
        <li><strong>Form factors:</strong> ${keyboard.form_factors || ""}</li>
        <li><strong>MCU:</strong> ${keyboard.mcu || ""}</li>
        <li><strong>Firmware:</strong> ${keyboard.firmware_targets || ""}</li>
        <li><strong>Last updated:</strong> ${keyboard.last_updated || ""}</li>
      `;
      document.getElementById("featured-keyboard-link").href = keyboard.repo;
    }

    var table = new Tabulator("#keyboard-table", {
      index: "name",
      layout: "fitColumns",
      pagination: "local",
      paginationSize: 10,
      responsiveLayout: "hide",
      selectableRows: 1,
      columns: [
        { title: "Name", field: "name", headerFilter: true, width: 120 },
        { title: "Keys", field: "keys", headerFilter: true, width: 70 },
        { title: "Form factors", field: "form_factors", headerFilter: true },
        { title: "MCU", field: "mcu", headerFilter: true },
        { title: "Firmware", field: "firmware_targets", headerFilter: true },
        { title: "Last updated", field: "last_updated", headerFilter: true, width: 120 },
      ],
    });
    table.on("rowClick", function(e, row) {
        updateFeaturedKeyboard(row.getData());
    });

    fetch("keyboards.json")
      .then(res => res.json())
      .then(data => {
        table.setData(data);
        table.selectRow(data[0].name);
        updateFeaturedKeyboard(data[0]);
      });

    // Add hjkl navigation for table row selection
    document.addEventListener("keydown", function(e) {
      if (["INPUT", "TEXTAREA"].includes(document.activeElement.tagName)) return;
      const selected = table.getSelectedRows();
      if (!selected.length) return;
      let idx = table.getRows().indexOf(selected[0]);
      if (e.key === "j" && idx < table.getRows().length - 1) {
        table.deselectRow();
        table.selectRow(table.getRows()[idx + 1]);
        updateFeaturedKeyboard(table.getRows()[idx + 1].getData());
        e.preventDefault();
      } else if (e.key === "k" && idx > 0) {
        table.deselectRow();
        table.selectRow(table.getRows()[idx - 1]);
        updateFeaturedKeyboard(table.getRows()[idx - 1].getData());
        e.preventDefault();
      }
    });

    // Ctrl+K or / to focus the filter input
    document.addEventListener("keydown", function(e) {
      if (e.ctrlKey && e.key.toLowerCase() === "k" || e.key === "/") {
        e.preventDefault();
        // Adjust the selector as needed for your table's filter input
        const nameFilter = document.querySelector('input[placeholder="Filter Name"]') 
          || document.querySelector('input[data-field="name"]')
          || document.querySelector('.tabulator-header input');
        if (nameFilter) nameFilter.focus();
      }
    });
  </script>
<script>
    let r = new XMLHttpRequest();
    r.addEventListener('load', function() {
        document.querySelector('#goatcounter-stats').innerText = JSON.parse(this.responseText).count
    })
    r.open('GET', 'https://keyboardbuilders.goatcounter.com/counter/' + encodeURIComponent(location.pathname) + '.json')
    r.send()
</script>
  <script data-goatcounter="https://keyboardbuilders.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
</body>
</html>
